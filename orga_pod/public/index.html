<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>Solorg Browser</title>

  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
  <link href="https://use.fontawesome.com/releases/v5.4.1/css/all.css" rel="stylesheet">
  <style>
  /*  .folder {
  background: yellow;
}
.file {
background: red;
}
.folder:before {
content: "this is ";
font-weight: bold;
font-style: italic;
}
.file:before {
content: "this FILE ";
font-weight: bold;
font-style: italic;
}*/
.parent:before {
  font-family: "Font Awesome 5 Free";
  content: "\f062";
  display: inline-block;
  padding-right: 3px;
  vertical-align: middle;
  font-weight: 900;
}
.folder:before {
  font-family: "Font Awesome 5 Free";
  content: "\f07b";
  display: inline-block;
  padding-right: 6px;
  vertical-align: middle;
  font-weight: 900;
}
.file:before {
  font-family: "Font Awesome 5 Free";
  content: "\f15b";
  display: inline-block;
  padding-right: 10px;
  vertical-align: middle;
  font-weight: 900;
}
/*
.file:after {
font-family: "Font Awesome 5 Free";
content: "\f0c5";
display: inline-block;
padding-left: 10px;
vertical-align: middle;
font-weight: 900;
}*/
.right{
  padding-left: 10px;
  vertical-align: middle;
  align: right;
}
i{
  padding-right: 10px;
}
</style>

</head>
<body>
  <div class="container-fluid">
    <div class="row header" style="height: 100px;">Header</div>

    <div class="row">
      <div class="col-md-2" id="menu">
        Menu
        <div class="dropdown" id="new-menu">
          <button class="btn btn-primary-outline dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            New
          </button>
          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
            <button class="dropdown-item" type="button"> <i class="fas fa-file-plus"></i>File</button>
            <button class="dropdown-item" type="button"> <i class="fas fa-folder-plus"></i>Folder</button>
            <div class="dropdown-divider"></div>
            <button class="dropdown-item" type="button"><i class="fas fa-file-upload"></i>Import File</button>
            <button class="dropdown-item" type="button"><i class="fas fa-upload"></i>Import Folder</button>
            <div class="dropdown-divider"></div>
            <button class="dropdown-item" type="button">Turtle</button>
            <button class="dropdown-item" type="button">Spoggy</button>
          </div>
        </div>

        <div class="dropdown" id="hola-menu">
          <button class="btn btn-primary-outline dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Hola
          </button>
          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
            <button class="dropdown-item" type="button" shape="https://holacratie.solid.community/public/Schema/organization.shex">Organization</button>
            <button class="dropdown-item" type="button" shape="https://holacratie.solid.community/public/Schema/user.shex">User</button>
            <button class="dropdown-item" type="button" shape="https://holacratie.solid.community/public/Schema/role.shex">Role</button>
            <button class="dropdown-item" type="button" shape="https://holacratie.solid.community/public/Schema/tension.shex">Tension</button>
            <button class="dropdown-item" type="button">Cercle</button>
            <button class="dropdown-item" type="button">Reunion / Meeting</button>
            <button class="dropdown-item" type="button">Projet</button>
            <button class="dropdown-item" type="button">Indicateur</button>
          </div>
        </div>



      </div>

      <div class="col-sm-12 col-md-6">
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb" id="breadcrumb">
            <li class="list-group-item">Loading File Browser... Please Wait...</li>
          </ol>
        </nav>

        <ul id="browser" class="list-group list-group-flush"
        style="height: 300px;overflow-y: auto;">
        <li class="list-group-item">Loading File Browser... Please Wait...</li>
      </ul>
    </div>

    <div class="col-md-4">
      <div class="form-group">
        <label for="content">File Content</label>
        <input id="filename" type="text" class="form-control" aria-label="Small" aria-describedby="inputGroup-sizing-sm">
        <textarea class="form-control" id="content" rows="10"></textarea>
        <button id="save" class="btn btn-outline-primary">Save</button>
      </div>
    </div>

  </div>

  <br>
  <hr>Tests<hr>

  <!-- Button trigger modal -->
  <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#modal-editor">
    Launch demo modal Editor
  </button>

  <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#modal-shape">
    Launch demo modal Shape
  </button>
  <!-- Content here -->

  Tripledoc : <div id="name"></div>
  <p>Click the button to display the hostname of the current URL.</p>

  <button onclick="myFunction()">Try it</button>

  <p id="demo"></p>
  <p id="webId"></p>
  Ldflex : <p id="user_storage"></p>

  <button class="btn btn-primary">OK</button>


</div>

<!-- Modal -->
<div  class="modal fade" id="modal-shape" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLongTitle">Modal shape</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body" id="form-shape">
        ...
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary">Save changes</button>
      </div>
    </div>
  </div>
</div>


<div id="modal-editor" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLongTitle">Editor</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        ...
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary">Save changes</button>
      </div>
    </div>
  </div>
</div>

<script>
function myFunction() {
  var x = location.hostname;
  document.getElementById("demo").innerHTML= x;
}
</script>

<script>
let menus = [
  {label: "New", items: [
    {label: "File", action: "http"},
    {label: "Folder", action: "http"},
    {label: "Import File", action: "http"},
    {label: "Import Folder", action: "http"},
    {label: "Turtle", action: "http"},
    {label: "Spoggy", action: "http"}
  ]},
  {label:"Hola", items:[
    {label: "Organization", shape: "http"},
    {label: "User", shape: "http"},
    {label: "Role", shape: "http"},
    {label: "Tension", shape: "http"},
    {label: "Cercle", shape: "http"},
    {label: "Meeting", shape: "http"},
    {label: "Projet", shape: "http"},
    {label: "Indicateur", shape: "http"}]}
  ]
</script>

<script src="https://solid.github.io/solid-auth-client/dist/solid-auth-client.bundle.js"></script>

<script src="https://solid.github.io/query-ldflex/dist/solid-query-ldflex.bundle.js"></script>
<script src="https://cdn.jsdelivr.net/npm/solid-file-client@1.0.0/dist/window/solid-file-client.bundle.js"></script>


<!--https://codesandbox.io/s/hardcore-elion-11ko6-->

<script src="https://wzrd.in/standalone/n3@latest"></script>
<script src="https://unpkg.com/tripledoc@latest/umd/index.js"></script>
<script>
Tripledoc.fetchDocument("https://vincentt.inrupt.net/profile/card").then(
  doc => {
    const person = doc.getSubject(
      "https://vincentt.inrupt.net/profile/card#me"
    );
    console.log("PRESON",person)
    document.getElementById(
      "name"
    ).textContent = `This person's name is ${person.getString(
      "http://xmlns.com/foaf/0.1/name"
    )}.`;
  }
);
</script>

<script
src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
integrity="sha256-4+XzXVhsDmqanXGHaHvgh1gMQKX40OUvDEBTu8JcmNs="
crossorigin="anonymous"></script>
<script src="https://unpkg.com/@popperjs/core@2"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.bundle.min.js" integrity="sha384-1CmrxMRARb6aLqgBO7yyAxTOQE2AKb9GfXnEo760AUcUmFx3ibVJJAzGytlQcNXd" crossorigin="anonymous"></script>

</body>
</html>


<script>
const auth = solid.auth
const fc   = new SolidFileClient(auth)
console.log("FC",fc)
let storage = ""

let current = ""

solid.auth.trackSession(session => {
  if (!session){
    console.log('The user is not logged in')
    document.getElementById("webId").innerHTML= "not logged";
    storage = ""
  }
  else{
    console.log(`The user is ${session.webId}`)
    document.getElementById("webId").innerHTML= `${session.webId}`;
    test_ldflex()

  }
})

async function test_ldflex(){
  const st = await solid.data.user.storage;
  storage = `${st}`
  console.log("SOLID DATA storage", storage)
  document.getElementById("user_storage").innerHTML= storage;
  // alert(`Welcome, ${await user.storage}!`);
  //  await readStorage(storage)

}

function read(path, type="folder"){
  if (type=="folder"){
    readFolder(path)
  }else{
    readFile(path)
  }
}

async function readFile(path){
  console.log(path)
  try {
    let content = await fc.readFile( path )
    console.log("Content", content)
    document.getElementById('content').value = content
    readFolder(path.substring(0, path.lastIndexOf("/") + 1))
  }
  catch(error) {
    console.log( error )         // A full error response
    console.log( error.status )  // Just the status code of the error
    console.log( error.message ) // Just the status code and statusText
    alert(error.message)
    //https://github.com/jeff-zucker/solid-file-client/blob/master/docs/error-handling.md
  }
}


async function readFolder(path){
  current = path


  try {
    fillBreadCrumb(path)
    let f = await fc.readFolder(path) //, {links:"include_possible"}
    console.log("HERE",f)
    $("#browser").empty()
    /*$("#browser").append($("<li>").attr("class", "list-group-item parent")
    .click(function() {
    read(f.parent)
    document.getElementById('content').innerHTML = ""
  })
  .text(f.parent));*/
  f.folders.forEach(fo => {
    $("#browser").append($("<li>").attr("class", "list-group-item folder")
    .click(function() {
      read(fo.url, fo.type)
      document.getElementById('content').value = ""
    })
    .text(fo.name));
  })

  f.files.forEach(fi => {
    $("#browser")
    .append($("<li>")
    .attr("class", "list-group-item file")
    .click(function(event) {
      read(fi.url, fi.type)
      $("#filename").val(fi.name)
    })
    .text(fi.name)
    .append($("<i>")
    .attr("class", "fas fa-copy right")

    .click(function(event) {
      event.stopPropagation();
      console.log(fi.url, fi.type)
    })
  )


);
})
}
catch(error) {
  console.log( error )         // A full error response
  console.log( error.status )  // Just the status code of the error
  console.log( error.message ) // Just the status code and statusText
  alert(error.message)
  //https://github.com/jeff-zucker/solid-file-client/blob/master/docs/error-handling.md
}




}

//fileclient
async function readStorage(st){
  let content = await fc.readFolder( st )
  console.log("CONTENT",content)
}
let path = location.href
//   console.log( await fc.readHead(path) )
if (location.href.endsWith('#')){
  path = location.href.slice(0, -1);
}
// console.log( await fc.readHead(path) )
console.log("PATH",path)
let type = "file"
path.split('/').pop().indexOf('.') > -1 ? type = "file" : type = "folder"


read(path, type)



function fillBreadCrumb(path){
  let crumbs = path.split("/")
  let url = ""
  $("#breadcrumb").empty()
  for (let i = 0; i < crumbs.length-1; i++){
    let crumb = crumbs[i]
    url = url+crumb+"/"
    if (i>1){
      $("#breadcrumb").append($("<li>").attr("class", "breadcrumb-item")
      .attr("url",url)
      .click(function() {
        read($(this).attr("url"), "folder")
        document.getElementById('content').value = ""
      })
      .text(crumb));
    }
  }

  /*
  crumbs.forEach(c => {

  $("#breadcrumb").append($("<li>").attr("class", "breadcrumb-item")
  .click(function() {
  read(c, "folder")
  document.getElementById('content').innerHTML = ""
})
.text(c));
})*/



}

$("#save").on("click", async function(){
  let filename = $("#filename").val()
  let content = $("#content").val()
  let url = current+filename
  console.log(url,content)
  //https://github.com/jeff-zucker/solid-file-client#createfile-fileurl-content-contenttype-options- "text/turtle"


  try {
    await fc.createFile(url, content, "text/plain")
    await  read(current, "folder")
  }
  catch(error) {
    console.log( error )         // A full error response
    console.log( error.status )  // Just the status code of the error
    console.log( error.message ) // Just the status code and statusText
    alert(error.message)
    //https://github.com/jeff-zucker/solid-file-client/blob/master/docs/error-handling.md
  }
})

// menus
$('#hola-menu .dropdown-item').on('click', function () {
  //  console.log(e.target.shape)
  let shape = $(this).attr("shape")
  console.log(shape)
  $('#form-shape').html("SHAPE "+shape)
  $('#modal-shape').modal('show')
  // do something…
})


</script>
